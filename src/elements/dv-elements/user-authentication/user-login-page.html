<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="login-form.html">
<link rel="import" href="loginform-with-openid.html">

<dom-module id="user-login-page">
    <style>
        :host {
            background: inherit;
            min-height: 400px;
        }

        #topheader{
            display: block;
            height: 45px;
            top: 0;
            left: 0;
        }

        #header {
            height: 24vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            margin: 0 !important;
            padding: 0 !important;
            border-bottom: 2px solid #ff3a39;
        }
        #header h1 {
            color: #fff;
            font-size: 24px;
            font-weight: 300;
            margin: 0 auto 16px;
            width: 300px;
        }

        :host #body {
            width: 100%;
            display: flex;
        }

        #loginform {
            width: 300px;
            margin: 16px auto;
        }
        loginform-with-openid {
            width:100%;
        }

        :host #footer {
            font-size: 14px;
            background: #3d4446;
            padding: 14px 26px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            box-sizing: border-box;
            align-items: center;
            position: absolute;
            bottom: 0;
            color: #fff;
        }
        #footer a {
            text-decoration: none;
            color: #00b4f0;
        }
        .hidden {
            display: none;
        }
        .show {
            display: block;
        }
    </style>
    <template>
        <div id="topheader">
            <paper-icon-button icon="menu" on-tap="showMenu" style="float: right;"></paper-icon-button>
        </div>

        <div id="header">
            <h1>[[organisationName]]</h1>
        </div>

        <div id="body">
            <login-form id="loginform" redirect-to="[[redirectInformation]]"
                        class$="[[_computedClass('lf', oicEnable)]]"></login-form>
            <loginform-with-openid id="loginformwithopenid"
                                   redirect-to="[[redirectInformation]]"
                                   class$="[[_computedClass('lfwo', oicEnable)]]"></loginform-with-openid>
        </div>

        <div id="footer">
            <span></span>
            <span>
                Powered by <a href="https://dcache.org">dCache</a>
            </span>
        </div>

    </template>
    <script>
        UserLoginPage = Polymer({
            is: "user-login-page",

            properties: {
                organisationName:{
                    type: String,
                    value: function () {
                        return window.CONFIG.orgName;
                    },
                    notify: true
                },

                oicEnable: {
                    type: Boolean,
                    notify: true
                },

                redirectInformation: {
                    type: Object,
                    notify: true
                },
            },

            factoryImpl: function(obj)
            {
                this.redirectInformation = obj;
            },

            ready: function ()
            {
                let a = window.CONFIG.oidcProviderName.trim().split(" ");
                let b = window.CONFIG.oidcClientId.trim().split(" ");
                let c = window.CONFIG.oidcAuthorizationEndpoint.trim().split(" ");

                if (a[0] !== "") {
                    let d,e,f;
                    if (a.includes(" ")) {
                        d = a.split(" ");
                        e = b.split(" ");
                        f = c.split(" ");
                    } else {
                        d = a;
                        e = b;
                        f = c;
                    }
                    this.oicEnable = d.length === e.length && d.length === f.length;
                } else {
                    this.oicEnable = false;
                }
            },

            attached: function ()
            {
                if (window.CONFIG.isSomebody) {
                    if (this.redirectInformation.page === "home") {
                        page("/");
                        app.ls(this.redirectInformation.path);
                    } else {
                        page("/"+this.redirectInformation.page);
                    }
                }
            },

            _computedClass: function (name, oicEnable)
            {
                let classes = '';
                switch (name) {
                    case 'lf':
                        classes = oicEnable ? ' hidden': ' show';
                        break;
                    case 'lfwo':
                        classes = oicEnable ? ' show': ' hidden';
                        break;
                }
                this.updateStyles();
                return classes;
            },

            showMenu: function ()
            {
                app.$.dfDrawerPanel.openDrawer();
            }
        })
    </script>
</dom-module>